<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing the calculation of MHWs in R vs Python - Basic • heatwaveR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- docsearch --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Comparing the calculation of MHWs in R vs Python - Basic">
<meta property="og:description" content="This vignette compares the code/work flow one would use to calculate default (Hobday et al. 2016) MHWs in both R and Python as well as the different outputs and speeds.">
<meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heatwaveR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.4.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/OISST_preparation.html">OISST preparation</a>
    </li>
    <li>
      <a href="../articles/gridded_event_detection.html">Extreme event detection in gridded data</a>
    </li>
    <li>
      <a href="../articles/Climatologies_and_baselines.html">Alternative climatologies and baselines</a>
    </li>
    <li>
      <a href="../articles/Short_climatologies.html">Short climatologies</a>
    </li>
    <li>
      <a href="../articles/r_vs_python.html">R vs Python</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/heatwaveR">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Comparing the calculation of MHWs in R vs Python - Basic</h1>
                        <h4 class="author">Robert W Schlegel</h4>
            
            <h4 class="date">2018-05-20</h4>
      
      
      <div class="hidden name"><code>r_vs_python.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The purpose of this vignette is to walk one through how to calculate MHWs in both the R and Python languages. It will use code from both languages throughout. The secondary purpose of this vignette is to show that the outputs are identical. The tertiary purpose of this vignette is to run benchmarks on the code to compare their speeds.</p>
</div>
<div id="calculating-events" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-events" class="anchor"></a>Calculating events</h2>
<p>First up, let’s look at the two different ways in which one may calculate MHWs. First up, the R code, then Python.</p>
<div id="r-code" class="section level3">
<h3 class="hasAnchor">
<a href="#r-code" class="anchor"></a>R code</h3>
<div id="setup" class="section level4">
<h4 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h4>
<p>The basic functionality for calculating marine heatwaves (MHWs) in R may be found in the <strong><code>heatwaveR</code></strong> package that may currently be downloaded and installed with the following lines of code. Note that if one has already installed these packages they do not need to be installed again. To run one of the lines in the following code chunk will require that the hashtag first be removed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">## Development version from GitHub</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># devtools::install_github("robwschlegel/heatwaveR") </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">## Stable version from rOpenSci</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">## Currently not available</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">## Stable version from CRAN</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co"># install.packages("heatwaveR") # Currently not available</span></a></code></pre></div>
<p>With the necessary packages installed, we activate <code>heatwaveR</code> with the following line of code.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(heatwaveR)</a></code></pre></div>
</div>
<div id="default-output" class="section level4">
<h4 class="hasAnchor">
<a href="#default-output" class="anchor"></a>Default output</h4>
<p>With everything downloaded and ready for us to use we may now calculate some events. The <code>heatwaveR</code> package has three built in time series (<code>sst_WA</code>, <code>sst_Med</code>, <code>sst_NW_Atl</code>) that we may use to more easily demonstrate how the code works. The general pipeline in <code>R</code> for calculating events is first to create a climatology from a chosen time series using <code><a href="../reference/ts2clm.html">ts2clm()</a></code>, and then to feed that ooutput into <code><a href="../reference/detect_event.html">detect_event()</a></code>, as seen below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># First we create a default climatology as outlined in Hobday et al. (2016)</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">ts_clim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ts2clm.html">ts2clm</a></span>(<span class="dt">data =</span> sst_WA, <span class="dt">climatologyPeriod =</span> <span class="kw">c</span>(<span class="st">"1982-01-01"</span>, <span class="st">"2014-12-31"</span>))</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"># Then we feed that object into the second and final function</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detect_event.html">detect_event</a></span>(ts_clim)</a></code></pre></div>
<p>To look at these outputs we would use the following options. For now we’ll just look at the event output.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Look at the top six rows of the first 6 columns of the events</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">res<span class="op">$</span>event[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   event_no index_start index_stop duration date_start date_stop 
##      &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;int&gt; &lt;date&gt;     &lt;date&gt;    
## 1        1         884        895       12 1984-06-02 1984-06-13
## 2        2         899        904        6 1984-06-17 1984-06-22
## 3        3         908        926       19 1984-06-26 1984-07-14
## 4        4        1008       1012        5 1984-10-04 1984-10-08
## 5        5        1023       1029        7 1984-10-19 1984-10-25
## 6        6        1033       1052       20 1984-10-29 1984-11-17</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># Or perhaps the most intense event</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">res<span class="op">$</span>event[res<span class="op">$</span>event<span class="op">$</span>intensity_max <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(res<span class="op">$</span>event<span class="op">$</span>intensity_max), <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   event_no index_start index_stop duration date_start date_stop 
##      &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;int&gt; &lt;date&gt;     &lt;date&gt;    
## 1       42       10629      10689       61 2011-02-06 2011-04-07</code></pre>
</div>
</div>
<div id="python-code" class="section level3">
<h3 class="hasAnchor">
<a href="#python-code" class="anchor"></a>Python code</h3>
<div id="setup-1" class="section level4">
<h4 class="hasAnchor">
<a href="#setup-1" class="anchor"></a>Setup</h4>
<p>To download and install the Python package for calculating MHWs one may run the following line of code in a console:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># Note that the hashtag must be removed in order</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co"># pip install git+git://github.com/ecjoliver/marineHeatWaves@master</span></a></code></pre></div>
<p>Or simply download the <a href="https://github.com/ecjoliver/marineHeatWaves">GitHub repository</a> and follow the instructions there for downloading. Or if still lost, phone a friend!</p>
<p>Before we begin the calculations we need to crerate a time series. I’ve chosen to take the <code>sst_WA</code> time series from the <strong><code>heatwaveR</code></strong> package to ensure consistency between the results. For ease of use I simply saved this object as a csv file on my computer and loaded it back in to Python.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">ts &lt;-<span class="st"> </span>sst_WA</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"># Write out only a vector of temperatures</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">write.csv</span>(ts<span class="op">$</span>temp, <span class="st">"sst_WA.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="default-calculations" class="section level4">
<h4 class="hasAnchor">
<a href="#default-calculations" class="anchor"></a>Default calculations</h4>
<p>With the package installed it is then activated and run as follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># Required for data prep and export</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="im">from</span> datetime <span class="im">import</span> date</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co"># The MHW functions</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="im">import</span> marineHeatWaves <span class="im">as</span> mhw</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co"># The date values</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">t <span class="op">=</span> np.arange(date(<span class="dv">1982</span>,<span class="dv">1</span>,<span class="dv">1</span>).toordinal(),date(<span class="dv">2014</span>,<span class="dv">12</span>,<span class="dv">31</span>).toordinal()<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co"># The temperature values</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">sst <span class="op">=</span> np.loadtxt(<span class="bu">open</span>(<span class="st">"sst_WA.csv"</span>, <span class="st">"r"</span>), delimiter<span class="op">=</span><span class="st">','</span>, skiprows<span class="op">=</span><span class="dv">1</span>) <span class="co"># because a heading row needs to be skipped</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co"># The event metrics</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">mhws, clim <span class="op">=</span> mhw.detect(t, sst)</a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co"># Save event results</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14">mhws_df <span class="op">=</span> pd.DataFrame.from_dict(mhws)</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">mhws_df.to_csv(<span class="st">'mhws_py.csv'</span>, sep <span class="op">=</span> <span class="st">','</span>, index<span class="op">=</span><span class="va">False</span>)</a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co"># Save climatology results</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17">clim_df <span class="op">=</span> pd.DataFrame.from_dict(clim)</a>
<a class="sourceLine" id="cb10-18" data-line-number="18">clim_df.to_csv(<span class="st">'clim_py.csv'</span>, sep <span class="op">=</span> <span class="st">','</span>, index<span class="op">=</span><span class="va">False</span>)</a></code></pre></div>
</div>
</div>
<div id="reticulate-code" class="section level3">
<h3 class="hasAnchor">
<a href="#reticulate-code" class="anchor"></a>Reticulate code</h3>
<p>It is also possible to run the Python code through R with the use of the R package <strong><code>reticulate</code></strong>. This is particularly useful as it allows us to perform the comparisons and benchmarking all within the same language.</p>
<div id="setup-2" class="section level4">
<h4 class="hasAnchor">
<a href="#setup-2" class="anchor"></a>Setup</h4>
<p>Here we load the <strong><code>reticulate</code></strong> package and choose the conda environment I’ve already created called <code>py27</code>. For help on how to set up a conda environment go <a href="https://conda.io/docs/user-guide/tasks/manage-environments.html">here</a>. I’ve ensured that all of the required python modules are installed within this environment.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># install.packages("reticulate")</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">library</span>(reticulate)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/use_python">use_condaenv</a></span>(<span class="st">"py27"</span>)</a></code></pre></div>
<p>Once we’ve told R which version/environment we would like to use for Python we may then load the necessary modules.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">np &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/import">import</a></span>(<span class="st">"numpy"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">datetime &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/import">import</a></span>(<span class="st">"datetime"</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">mhw &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/import">import</a></span>(<span class="st">"marineHeatWaves"</span>)</a></code></pre></div>
<p>One may run python code in it’s native form within R by passing it as a character vector to <code><a href="http://www.rdocumentation.org/packages/reticulate/topics/py_run">py_run_string()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/py_run">py_run_string</a></span>(<span class="st">"x = 10"</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/py_run">py_run_string</a></span>(<span class="st">"t = np.arange(date(1982,1,1).toordinal(),date(2014,12,31).toordinal()+1)"</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/py_run">py_run_string</a></span>(<span class="st">"sst = np.loadtxt(open('sst_WA.csv', 'r'), delimiter=',', skiprows=1)"</span>)</a></code></pre></div>
</div>
<div id="default-calculations-1" class="section level4">
<h4 class="hasAnchor">
<a href="#default-calculations-1" class="anchor"></a>Default calculations</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># These numbers were taken from print(t) in the python code above</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">t &lt;-<span class="st"> </span><span class="kw">as.integer</span>(np<span class="op">$</span><span class="kw">array</span>(<span class="kw">seq</span>(<span class="dv">723546</span>, <span class="dv">735598</span>)))</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">sst &lt;-<span class="st"> </span>np<span class="op">$</span><span class="kw">array</span>(sst_WA<span class="op">$</span>temp)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">res_python &lt;-<span class="st"> </span>mhw<span class="op">$</span><span class="kw">detect</span>(<span class="dt">t =</span> py<span class="op">$</span>t, <span class="dt">temp =</span> py<span class="op">$</span>sst) <span class="co"># There appears to be an Rcpp issue preventing this from handshaking...</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co"># The reticulate package is still in development...</span></a></code></pre></div>
</div>
</div>
</div>
<div id="comparisons" class="section level2">
<h2 class="hasAnchor">
<a href="#comparisons" class="anchor"></a>Comparisons</h2>
<p>With some climatologies and events calculated with both languages we may now compare the results of the two. I’ll do so here natively in R to avoid any potential hiccups from translating across languages. I’ll create the R output here, and load the Python output created above.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># Load libraries for data manipulation and visualisation</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co"># Set R results</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">res_event_R &lt;-<span class="st"> </span>res<span class="op">$</span>event</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">res_clim_R &lt;-<span class="st"> </span>res<span class="op">$</span>climatology</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co"># Set Python results</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9">res_event_Python &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"mhws_py.csv"</span>)</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">res_clim_Python &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"clim_py.csv"</span>)</a></code></pre></div>
<p>With these default results loaded in the same format in the same language we can now start to look at how they stack up. For starters I am just doing some simple correlations.</p>
<div id="climatologies" class="section level3">
<h3 class="hasAnchor">
<a href="#climatologies" class="anchor"></a>Climatologies</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">cor</span>(res_clim_R<span class="op">$</span>seas, res_clim_Python<span class="op">$</span>seas)</a></code></pre></div>
<pre><code>## [1] 0.9999999</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">cor</span>(res_clim_R<span class="op">$</span>thresh, res_clim_Python<span class="op">$</span>thresh)</a></code></pre></div>
<pre><code>## [1] 0.9999996</code></pre>
<p>That looks about right. Good to see things getting off to a good start. Now for the events.</p>
</div>
<div id="events" class="section level3">
<h3 class="hasAnchor">
<a href="#events" class="anchor"></a>Events</h3>
<p>First we peak at a few specific values of interest.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">cor</span>(res_event_R<span class="op">$</span>intensity_max, res_event_Python<span class="op">$</span>intensity_max)</a></code></pre></div>
<pre><code>## [1] 0.9999997</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">cor</span>(res_event_R<span class="op">$</span>intensity_var, res_event_Python<span class="op">$</span>intensity_var)</a></code></pre></div>
<pre><code>## [1] 0.999608</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">cor</span>(res_event_R<span class="op">$</span>rate_onset, res_event_Python<span class="op">$</span>rate_onset)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">cor</span>(res_event_R<span class="op">$</span>rate_decline, res_event_Python<span class="op">$</span>rate_decline)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>With that looking fine, we next run a for loop that will run a correlation on all rows with the same name.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># Remove non-numeric columns</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">res_event_num &lt;-<span class="st"> </span>res_event_R <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="st">  </span><span class="kw">select_if</span>(is.numeric)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4"></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co"># Run the loop</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6">res_event_cor &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">colnames</span>(res_event_num))){</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  <span class="cf">if</span>(<span class="kw">colnames</span>(res_event_num)[i] <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(res_event_Python) <span class="op">&amp;</span><span class="st"> </span>res_event_R[<span class="dv">1</span>,i] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">    x1 &lt;-<span class="st"> </span>res_event_R[<span class="kw">colnames</span>(res_event_R) <span class="op">==</span><span class="st"> </span><span class="kw">colnames</span>(res_event_num)[i]]</a>
<a class="sourceLine" id="cb28-10" data-line-number="10">    x2 &lt;-<span class="st"> </span>res_event_Python[<span class="kw">colnames</span>(res_event_Python) <span class="op">==</span><span class="st"> </span><span class="kw">colnames</span>(res_event_num)[i]]</a>
<a class="sourceLine" id="cb28-11" data-line-number="11">    x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">r =</span> <span class="kw">cor</span>(x1, x2), <span class="dt">var =</span> <span class="kw">colnames</span>(res_event_num)[i])</a>
<a class="sourceLine" id="cb28-12" data-line-number="12">    <span class="kw">colnames</span>(x)[<span class="dv">1</span>] &lt;-<span class="st"> "r"</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13">    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb28-15" data-line-number="15">    x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">r =</span> <span class="ot">NA</span>, <span class="dt">var =</span> <span class="kw">colnames</span>(res_event_num)[i])</a>
<a class="sourceLine" id="cb28-16" data-line-number="16">    <span class="co"># colnames(x) &lt;- colnames(res_event_R)[i]</span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17">  }</a>
<a class="sourceLine" id="cb28-18" data-line-number="18">  res_event_cor &lt;-<span class="st"> </span><span class="kw">rbind</span>(res_event_cor, x)</a>
<a class="sourceLine" id="cb28-19" data-line-number="19">}</a>
<a class="sourceLine" id="cb28-20" data-line-number="20">res_event_cor</a></code></pre></div>
<pre><code>##            r                            var
## 1         NA                       event_no
## 2  1.0000000                    index_start
## 3         NA                     index_stop
## 4  1.0000000                       duration
## 5  0.9999991                 intensity_mean
## 6  0.9999997                  intensity_max
## 7  0.9996080                  intensity_var
## 8  1.0000000           intensity_cumulative
## 9  0.9999971       intensity_mean_relThresh
## 10 0.9999994        intensity_max_relThresh
## 11 0.9995685        intensity_var_relThresh
## 12 0.9999996 intensity_cumulative_relThresh
## 13 1.0000000             intensity_mean_abs
## 14 0.9990733              intensity_max_abs
## 15 0.9997267              intensity_var_abs
## 16 1.0000000       intensity_cumulative_abs
## 17        NA            intensity_mean_norm
## 18        NA             intensity_max_norm
## 19 1.0000000                     rate_onset
## 20 1.0000000                   rate_decline</code></pre>
<p>With all of our overlapping columns compared, and our Pearson r values looking solid, let’s finish off this basic comparison by finding which columns are not shared between the different language outputs.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">cols_R &lt;-<span class="st"> </span><span class="kw">colnames</span>(res_event_R)[<span class="op">!</span>(<span class="kw">colnames</span>(res_event_R) <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(res_event_Python))]</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">cols_R</a></code></pre></div>
<pre><code>## [1] "event_no"            "index_stop"          "date_stop"          
## [4] "intensity_mean_norm" "intensity_max_norm"</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">cols_Py &lt;-<span class="st"> </span><span class="kw">colnames</span>(res_event_Python)[<span class="op">!</span>(<span class="kw">colnames</span>(res_event_Python) <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(res_event_R))]</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">cols_Py</a></code></pre></div>
<pre><code>##  [1] "category"          "date_end"          "duration_extreme" 
##  [4] "duration_moderate" "duration_severe"   "duration_strong"  
##  [7] "index_end"         "index_peak"        "n_events"         
## [10] "time_end"          "time_peak"         "time_start"</code></pre>
<p>Wonderful! Most things match up nicely. There is some disagreement between the use of the word “stop” or “end” that must be sorted out. The R output also has a couple of “norm” columns that are not produced by Python and should maybe be omitted. The R output must also have an “index_peak” column added. The duration of categories of events is something added in R by another function <code><a href="../reference/category.html">category()</a></code>, and will be left that way for now. The “time” columns in the Python output aren’t relavent as far as I can see in the present usage as these functions currently only take day values.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="co"># Still to be compared and benchmarked</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">mhwBlock <span class="op">=</span> mhw.blockAverage(t, mhws, clim)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">mean, trend, dtrend <span class="op">=</span> mhw.meanTrend(mhwBlock)</a></code></pre></div>
</div>
</div>
<div id="benchmarks" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmarks" class="anchor"></a>Benchmarks</h2>
<p>The final thing we want to look at in this vignette is the speed differences in calculating MHWs between the two languages.</p>
<div id="r" class="section level3">
<h3 class="hasAnchor">
<a href="#r" class="anchor"></a>R</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/detect_event.html">detect_event</a></span>(<span class="kw"><a href="../reference/ts2clm.html">ts2clm</a></span>(<span class="dt">data =</span> sst_WA, <span class="dt">climatologyPeriod =</span> <span class="kw">c</span>(<span class="st">"1982-01-01"</span>, <span class="st">"2014-12-31"</span>))))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.201   0.017   0.220</code></pre>
</div>
<div id="python" class="section level3">
<h3 class="hasAnchor">
<a href="#python" class="anchor"></a>Python</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="im">import</span> time</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">t1 <span class="op">=</span> time.time()</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">mhws, clim <span class="op">=</span> mhw.detect(t, sst)</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">t2 <span class="op">=</span> time.time()</a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="bu">print</span>(t2<span class="op">-</span>t1)</a></code></pre></div>
<p>The python code appears to be about twice as fast. And it is calculating the event categories as well, which R is not. That is done in an additonal step with <code><a href="../reference/category.html">category()</a></code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#calculating-events">Calculating events</a></li>
      <li><a href="#comparisons">Comparisons</a></li>
      <li><a href="#benchmarks">Benchmarks</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robert W. Schlegel, Eric C. J. Oliver, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script>
  docsearch({
    
    
    apiKey: '2edc7627dae0471f3d765c3355bebbf3',
    indexName: 'heatwaver',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
