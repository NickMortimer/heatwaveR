<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Complex Climatologies • heatwaveR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Complex Climatologies">
<meta property="og:description" content="This vignette walks the user through a case study on the application of more complex climatology calculations.">
<meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heatwaveR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.6.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/detection_and_visualisation.html">Basic Detection and Visualisation of Events</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Calculating and Visualising Exceedances</a>
    </li>
    <li>
      <a href="../articles/event_categories.html">Calculating and Visualising Event Categories</a>
    </li>
    <li>
      <a href="../articles/OISST_preparation.html">Downloading and Preparing OISST Data</a>
    </li>
    <li>
      <a href="../articles/gridded_event_detection.html">Detecting Events in Gridded Data</a>
    </li>
    <li>
      <a href="../articles/complex_clims.html">Complex Climatologies</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/heatwaveR">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Complex Climatologies</h1>
                        <h4 class="author">Robert W Schlegel</h4>
            
            <h4 class="date">2019-01-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/robwschlegel/heatwaveR/blob/master/vignettes/complex_clims.Rmd"><code>vignettes/complex_clims.Rmd</code></a></small>
      <div class="hidden name"><code>complex_clims.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>One of the long term goals of <strong><code>heatwaveR</code></strong> is the inclusion of many different methods for the creation of climatologies for the use of detecting heatwaves and cold-spells in time series data. To this end we have made a very large change in the event detection pipeline, which is why we moved from the <strong><code>RmarineHeatWaves</code></strong> package to <strong><code>heatwaveR</code></strong>. This change was the inclusion of the <code><a href="../reference/ts2clm.html">ts2clm()</a></code> function and the removal of climatology generating found in <code><a href="https://www.rdocumentation.org/packages/RmarineHeatWaves/topics/detect">RmarineHeatWaves::detect()</a></code> in favour of <code><a href="../reference/detect_event.html">detect_event()</a></code>, which does not calculate climatologies. In this way we have allowed for the introduction of a multitude of more complex climatology calculation and event detection methods. It is our overarching goal to provide one package that allows climate scientists to calculate these events in both the atmosphere and oceans. But rather than talking about it, let’s walk through a case study on how this shift in the main pipeline of this package can be used for diverse applications.</p>
<p>Brought to our attention by Mr. Haouari from the IHFR institute of meteorology in Algeria was the concept of using a flat 25<span class="math inline">\(^\circ\)</span>C <code>tMin</code> bottom boundary to screen out events calculated from <code>tMax</code> with the standard 90th percentile upper threshold. As the authors of the <strong><code>heatwaveR</code></strong> package are admittedly marine oriented, we tend to work with daily time series that have only one mean value per day. The use of <code>tMin</code> and <code>tMax</code> is therefore not accommodated explicitly in the arguments that one gives to the <code><a href="../reference/ts2clm.html">ts2clm()</a></code> and <code><a href="../reference/detect_event.html">detect_event()</a></code> functions, but that does not mean that one cannot do so. Below we will work through the steps one would take to calculate (atmospheric) heatwaves, as per their definition in <span class="citation">Perkins and Alexander (2013)</span>, but excluding the calculation of EHF, and with the additional step proposed by Mr. Haouari. In the interest of reproducibility, we will be creating a <code>tMin</code> and <code>tMax</code> time series from the <code>sst_WA</code> data that is installed with <strong><code>heatwaveR</code></strong>. This is not technically correct to do, but will allow us to illustrate the methodology.</p>
</div>
<div id="the-methodology" class="section level2">
<h2 class="hasAnchor">
<a href="#the-methodology" class="anchor"></a>The methodology</h2>
<p>In the following sub-sections we will walk through the step-by-step approach needed to calculate atmospheric heatwaves using a 90th percentile threshold created from the <code>tMax</code> time series for a location, and then filter the events based on the <code>tMin</code> series also needing to exceed 25<span class="math inline">\(^\circ\)</span>C on the same days. We will finish by showing how to then convert these results back into a format that <code><a href="../reference/event_line.html">event_line()</a></code> and <code>lolli_plot</code> like so that one may still use these convenient functions to visualise the results. After we have shown this we will also demonstrate how to detect events with two different percentile thresholds at the same time.</p>
<div id="data-prep" class="section level3">
<h3 class="hasAnchor">
<a href="#data-prep" class="anchor"></a>Data prep</h3>
<p>The first step with any analysis in R should be the loading of the packages to be used.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggpubr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(heatwaveR)</code></pre></div>
<p>With our libraries loaded, we will now go about creating artificial <code>tMin</code> and <code>tMax</code> time series from <code>sst_WA</code>. Again, please note that this is not actually something that one should do. We only do so here as <strong><code>heatwaveR</code></strong> does not have any built-in atmospheric data. Real <code>tMin</code> and <code>tMax</code> time series should be used when one is executing this methodology for proper research.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create tMin time series</span>
tMin &lt;-<span class="st"> </span>sst_WA <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">temp =</span> temp <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)

<span class="co"># Create tMax time series</span>
tMax &lt;-<span class="st"> </span>sst_WA <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">temp =</span> temp <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
</div>
<div id="climatology-calculation" class="section level3">
<h3 class="hasAnchor">
<a href="#climatology-calculation" class="anchor"></a>Climatology calculation</h3>
<p>With our artificial time series created, we will now calculate the two thresholds we need to correctly detect and filter the heatwaves. The first is the 90th percentile threshold based on the <code>tMax</code> time series. The second is the exceedance of 25<span class="math inline">\(^\circ\)</span>C based on the <code>tMin</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The tMax threshold</span>
<span class="co"># The WMO standard climatology period 0f 1981-01-01 to 2010-12-31 should be used where possible.</span>
<span class="co"># Unfortunately, the OISST data, from which these data were drawn, only begin in 1982-01-01</span>
tMax_clim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ts2clm.html">ts2clm</a></span>(tMax, <span class="dt">climatologyPeriod =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"1982-01-01"</span>, <span class="st">"2011-12-31"</span>), <span class="dt">pctile =</span> <span class="dv">90</span>)

<span class="co"># The tMin exceedance</span>
<span class="co"># Note the use here of 'minDuration = 3' and 'maxGap = 1' as the default atmospheric arguments</span>
<span class="co"># The deafult marine arguemnts are 'minDuration = 5' and 'maxGap = 2'</span>
tMin_exc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/exceedance.html">exceedance</a></span>(tMin, <span class="dt">threshold =</span> <span class="dv">25</span>, <span class="dt">minDuration =</span> <span class="dv">3</span>, <span class="dt">maxGap =</span> <span class="dv">1</span>)

<span class="co"># Pull out each data.frame as there own object for easier use</span>
tMin_exc_exceedance &lt;-<span class="st"> </span>tMin_exc<span class="op">$</span>exceedance
tMin_exc_threshold &lt;-<span class="st"> </span>tMin_exc<span class="op">$</span>threshold</code></pre></div>
</div>
<div id="event-detection" class="section level3">
<h3 class="hasAnchor">
<a href="#event-detection" class="anchor"></a>Event detection</h3>
<p>With our climatologies calculated we may now go about detecting the events in the <code>tMax</code> time series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Note the use here of 'minDuration = 3' and 'maxGap = 1' as the default atmospheric arguments</span>
tMax_event &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detect_event.html">detect_event</a></span>(tMax_clim, <span class="dt">minDuration =</span> <span class="dv">3</span>, <span class="dt">maxGap =</span> <span class="dv">1</span>)

<span class="co"># Pull out each data.frame as there own object for easier use</span>
tMax_event_event &lt;-<span class="st"> </span>tMax_event<span class="op">$</span>event
tMax_event_climatology &lt;-<span class="st"> </span>tMax_event<span class="op">$</span>climatology</code></pre></div>
<p>With all of the events detected we may now use the <code>tMin_exc_threshold</code> object to screen out the events in <code>tMax_event_event</code> that had tMin values below our chosen bottom limit of 25<span class="math inline">\(^\circ\)</span>C.</p>
</div>
<div id="filtering-events" class="section level3">
<h3 class="hasAnchor">
<a href="#filtering-events" class="anchor"></a>Filtering events</h3>
<p>This is where things may get tricky for some users, and where the default use of the functions in the <strong><code>heatwaveR</code></strong> package ends. We are now going ‘off-road’ so to speak. But do not despair! The <strong><code>tidyverse</code></strong> suite of packages makes data wrangling like this much more user friendly than it was in the dark days of Base R coding.</p>
<p>In order to make the filtering of events easier, we will combine the two different dataframes that we are using as guides to chose the events that meet all of our selection criteria.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Join the climatology outputs of detect_event() and exceedence()</span>
ts_clims &lt;-<span class="st"> </span><span class="kw">left_join</span>(tMax_event_climatology, tMin_exc_threshold, <span class="dt">by =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"t"</span>))

<span class="co"># Remove all days that did not qualify for exceddence()</span>
ts_clims_filtered &lt;-<span class="st"> </span>ts_clims <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(exceedance <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)</code></pre></div>
<p>With our two different filtering indices combined into one dataframe we only need one more ingredient before we can create our final product. We have already decided that we want to screen out events that dipped below a given static bottom threshold. Presumably this is a biologically relevant value that has been determined <em>a priori</em> through some other research. But how many days must the <code>tMin</code> values during the event go below this threshold before it must be excluded from our research? The following chunk of code shows how to calculate the number of days during each event that <code>tMin</code> went below the bottom threshold. What one chooses to do with that information is shown in the following chunk.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate number of days for each event above the 25C threshold</span>
ts_event_duration_thresh &lt;-<span class="st"> </span>ts_clims_filtered <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(event_no) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">event_duration_thresh =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>()</code></pre></div>
<p>Now that we have a third and final filtering index we may extract the events that meet all of the criteria we haven chosen to impose on them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Filter out the events that were not above the static bottom threshold for their entire duration</span>
ts_events_filtered &lt;-<span class="st"> </span><span class="kw">left_join</span>(tMax_event_event, ts_event_duration_thresh, <span class="dt">by =</span> <span class="st">"event_no"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(event_duration_thresh <span class="op">==</span><span class="st"> </span>duration)
ts_events_filtered</code></pre></div>
<pre><code>## # A tibble: 0 x 23
## # ... with 23 variables: event_no &lt;dbl&gt;, index_start &lt;dbl&gt;,
## #   index_peak &lt;dbl&gt;, index_end &lt;dbl&gt;, duration &lt;dbl&gt;, date_start &lt;date&gt;,
## #   date_peak &lt;date&gt;, date_end &lt;date&gt;, intensity_mean &lt;dbl&gt;,
## #   intensity_max &lt;dbl&gt;, intensity_var &lt;dbl&gt;, intensity_cumulative &lt;dbl&gt;,
## #   intensity_mean_relThresh &lt;dbl&gt;, intensity_max_relThresh &lt;dbl&gt;,
## #   intensity_var_relThresh &lt;dbl&gt;, intensity_cumulative_relThresh &lt;dbl&gt;,
## #   intensity_mean_abs &lt;dbl&gt;, intensity_max_abs &lt;dbl&gt;,
## #   intensity_var_abs &lt;dbl&gt;, intensity_cumulative_abs &lt;dbl&gt;,
## #   rate_onset &lt;dbl&gt;, rate_decline &lt;dbl&gt;, event_duration_thresh &lt;int&gt;</code></pre>
<p>Above we see that the result of all of our filtering is that no events occurred within the time series that meet our criteria. We therefore need to loosen up a bit. We may do this by not requiring that the <code>tMin</code> for the events not be above the bottom threshold for their <em>entire</em> duration. To do so we will change the way in which we filter for <code>ts_events_filtered</code>. The following code chunk shows how to screen out events that did not exceed the bottom threshold for more than 3 days.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ts_events_filtered &lt;-<span class="st"> </span><span class="kw">left_join</span>(tMax_event_event, ts_event_duration_thresh, <span class="dt">by =</span> <span class="st">"event_no"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(event_duration_thresh <span class="op">&gt;=</span><span class="st"> </span>duration <span class="op">-</span><span class="st"> </span><span class="dv">3</span>)
ts_events_filtered</code></pre></div>
<pre><code>## # A tibble: 0 x 23
## # ... with 23 variables: event_no &lt;dbl&gt;, index_start &lt;dbl&gt;,
## #   index_peak &lt;dbl&gt;, index_end &lt;dbl&gt;, duration &lt;dbl&gt;, date_start &lt;date&gt;,
## #   date_peak &lt;date&gt;, date_end &lt;date&gt;, intensity_mean &lt;dbl&gt;,
## #   intensity_max &lt;dbl&gt;, intensity_var &lt;dbl&gt;, intensity_cumulative &lt;dbl&gt;,
## #   intensity_mean_relThresh &lt;dbl&gt;, intensity_max_relThresh &lt;dbl&gt;,
## #   intensity_var_relThresh &lt;dbl&gt;, intensity_cumulative_relThresh &lt;dbl&gt;,
## #   intensity_mean_abs &lt;dbl&gt;, intensity_max_abs &lt;dbl&gt;,
## #   intensity_var_abs &lt;dbl&gt;, intensity_cumulative_abs &lt;dbl&gt;,
## #   rate_onset &lt;dbl&gt;, rate_decline &lt;dbl&gt;, event_duration_thresh &lt;int&gt;</code></pre>
<p>Still zero events. Were we to have a peak at <code>ts_event_duration_thresh</code> we would see that there were only three heatwaves in the entire time series that had <code>tMin</code> values exceeding the static threshold that we set at 25<span class="math inline">\(^\circ\)</span>C. Furthermore, the majority of the <code>tMin</code> values are below the threshold. So rather than allowing for a set number of days below this threshold, let’s rather ask R to screen out events with only a certain <em>proportion</em> of days below this threshold. Let’s be generous and set this at 25% (i.e. 1/4).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ts_events_filtered &lt;-<span class="st"> </span><span class="kw">left_join</span>(tMax_event_event, ts_event_duration_thresh, <span class="dt">by =</span> <span class="st">"event_no"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(event_duration_thresh <span class="op">&gt;=</span><span class="st"> </span>duration <span class="op">/</span><span class="st"> </span><span class="dv">4</span>)
ts_events_filtered</code></pre></div>
<pre><code>## # A tibble: 2 x 23
##   event_no index_start index_peak index_end duration date_start date_peak 
##      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;    
## 1       80        9581       9601      9615       35 2008-03-25 2008-04-14
## 2       92       10585      10651     10689      105 2010-12-24 2011-02-28
## # ... with 16 more variables: date_end &lt;date&gt;, intensity_mean &lt;dbl&gt;,
## #   intensity_max &lt;dbl&gt;, intensity_var &lt;dbl&gt;, intensity_cumulative &lt;dbl&gt;,
## #   intensity_mean_relThresh &lt;dbl&gt;, intensity_max_relThresh &lt;dbl&gt;,
## #   intensity_var_relThresh &lt;dbl&gt;, intensity_cumulative_relThresh &lt;dbl&gt;,
## #   intensity_mean_abs &lt;dbl&gt;, intensity_max_abs &lt;dbl&gt;,
## #   intensity_var_abs &lt;dbl&gt;, intensity_cumulative_abs &lt;dbl&gt;,
## #   rate_onset &lt;dbl&gt;, rate_decline &lt;dbl&gt;, event_duration_thresh &lt;int&gt;</code></pre>
<p>And now we see that two heatwaves emerge from the fold. One moderately long event from 2008, and ol’ faithful in 2010-2011 <span class="citation">(Wernberg et al. 2016)</span>.</p>
</div>
</div>
<div id="visuals" class="section level2">
<h2 class="hasAnchor">
<a href="#visuals" class="anchor"></a>Visuals</h2>
<p>We may now have our desired results, but if we want them to work with the built-in visualisation functions that come with <strong><code>heatwaveR</code></strong> we need one more step.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create artificial list object similar to detect_event() output</span>
ts_filtered_list &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">climatology =</span> tMax_event_climatology,
                            <span class="dt">event =</span> ts_events_filtered)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Then run event_line() on it</span>
<span class="kw"><a href="../reference/event_line.html">event_line</a></span>(ts_filtered_list, <span class="dt">start_date =</span> <span class="st">"2010-01-01"</span>, <span class="dt">end_date =</span> <span class="st">"2012-05-30"</span>, <span class="dt">spread =</span> <span class="dv">50</span>)</code></pre></div>
<p><img src="complex_clims_files/figure-html/event-line1-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Or visualise the categories</span>
<span class="kw"><a href="../reference/event_line.html">event_line</a></span>(ts_filtered_list, <span class="dt">start_date =</span> <span class="st">"2010-01-01"</span>, <span class="dt">end_date =</span> <span class="st">"2012-05-30"</span>, 
           <span class="dt">spread =</span> <span class="dv">50</span>, <span class="dt">category =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="complex_clims_files/figure-html/event-line2-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Or lolli_plot as desired</span>
<span class="kw"><a href="../reference/lolli_plot.html">lolli_plot</a></span>(ts_filtered_list, <span class="dt">event_count =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="complex_clims_files/figure-html/lolli-plot-1.png" width="768"></p>
<p>One may of course visualise the outputs from the events calculated here with <code><a href="../reference/geom_flame.html">geom_flame()</a></code> and <code><a href="../reference/geom_lolli.html">geom_lolli()</a></code> as well, but this will not differ from the default method of using these functions as outlined in their help files so we will not go into that here.</p>
</div>
<div id="categories" class="section level2">
<h2 class="hasAnchor">
<a href="#categories" class="anchor"></a>Categories</h2>
<p>If one then wants to calculate the categories of the events that have met all of the rigours of our complex climatology one will use the same list object created for the visuals above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ts_category &lt;-<span class="st"> </span><span class="kw"><a href="../reference/category.html">category</a></span>(ts_filtered_list, <span class="dt">name =</span> <span class="st">"WA"</span>)
ts_category</code></pre></div>
<pre><code>## # A tibble: 2 x 11
##   event_no event_name peak_date  category i_max duration p_moderate
##      &lt;dbl&gt; &lt;fct&gt;      &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
## 1       80 WA 2008    2008-04-14 III Sev…  3.83       35         57
## 2       92 WA 2011    2011-02-28 IV Extr…  6.58      105         52
## # ... with 4 more variables: p_strong &lt;dbl&gt;, p_severe &lt;dbl&gt;,
## #   p_extreme &lt;dbl&gt;, season &lt;chr&gt;</code></pre>
</div>
<div id="double-climatologies" class="section level2">
<h2 class="hasAnchor">
<a href="#double-climatologies" class="anchor"></a>Double climatologies</h2>
<p>The methodology outlined above for the detection/filtering of events with multiple climatologies/thresholds is somewhat cumbersome. Another issue with this technique is that the multiple filters do not affect the calculation of the event metrics (e.g. cumulative intensity), only the primary threshold given to <code><a href="../reference/detect_event.html">detect_event()</a></code> is used. If one want to calculate events based on two different thresholds, one must use the arguments built into <code><a href="../reference/detect_event.html">detect_event()</a></code>. Below we will show two examples of how to do this with the <code>sst_Med</code> data.</p>
<div id="static-second-threshold" class="section level3">
<h3 class="hasAnchor">
<a href="#static-second-threshold" class="anchor"></a>Static second threshold</h3>
<p>First up we will look at how to calculate event metrics based on a flat bottom threshold of 19<span class="math inline">\(^\circ\)</span>C and a normal upper threshold of the 90th percentile. To spice things up we are also going to require that the bottom threshold of 19<span class="math inline">\(^\circ\)</span>C be exceeded for at least 10 days, and we will not allow for any gaps during this time. We will use the default duration and gaps for the 90th percentile threshold.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First we calculate the exceedance as desired</span>
thresh_<span class="dv">19</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/exceedance.html">exceedance</a></span>(sst_Med, <span class="dt">threshold =</span> <span class="dv">19</span>, <span class="dt">minDuration =</span> <span class="dv">10</span>, <span class="dt">maxGap =</span> <span class="dv">0</span>)<span class="op">$</span>threshold

<span class="co"># Then we use that output when detecting our events</span>
events_<span class="dv">19</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detect_event.html">detect_event</a></span>(<span class="kw"><a href="../reference/ts2clm.html">ts2clm</a></span>(sst_Med, <span class="dt">climatologyPeriod =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"1982-01-01"</span>, <span class="st">"2011-12-31"</span>)), 
                                 <span class="dt">threshClim2 =</span> thresh_<span class="dv">19</span><span class="op">$</span>exceedance, <span class="dt">minDuration2 =</span> <span class="dv">10</span>, <span class="dt">maxGap2 =</span> <span class="dv">0</span>)</code></pre></div>
<p>And that’s all there is to it. Let’s visualise these results against the a standard output to see how they differ. Another benefit of performing complex calculations this way is that the output is already in the format that <code><a href="../reference/event_line.html">event_line()</a></code>, <code><a href="../reference/lolli_plot.html">lolli_plot()</a></code>, and <code><a href="../reference/category.html">category()</a></code> already want.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The default output</span>
events_default &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detect_event.html">detect_event</a></span>(<span class="kw"><a href="../reference/ts2clm.html">ts2clm</a></span>(sst_Med, <span class="dt">climatologyPeriod =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"1982-01-01"</span>, <span class="st">"2011-12-31"</span>)))

<span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/ggarrange">ggarrange</a></span>(<span class="kw"><a href="../reference/lolli_plot.html">lolli_plot</a></span>(events_<span class="dv">19</span>), <span class="kw"><a href="../reference/lolli_plot.html">lolli_plot</a></span>(events_default), <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Two thresholds"</span>, <span class="st">"One threshold"</span>))</code></pre></div>
<p><img src="complex_clims_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>We may see in the right hand panel that all of the smaller events, many of the larger events, and even two of the largest events were all screened out by our inclusion of the 19<span class="math inline">\(^\circ\)</span>C static threshold. Please note however that even though the use of the second threshold in this way does allow for the calculation of the event metrics to differ, the values themselves are still being calculated against the seasonal climatology and so using a second threshold won’t generally have much of an effect on the event metric. Rather it mostly screens out smaller or larger events depending on how one chooses to set the threshold.</p>
</div>
<div id="percentile-second-hreshold" class="section level3">
<h3 class="hasAnchor">
<a href="#percentile-second-hreshold" class="anchor"></a>Percentile second hreshold</h3>
<p>Using a percentile threshold is not much different than using a static threshold. Rather than using <code><a href="../reference/exceedance.html">exceedance()</a></code> to get our second threshold we will use <code><a href="../reference/detect_event.html">detect_event()</a></code>. Below we will look at how to calculate normal events (5 day minimum duration above the 90th percentile with a 2 day max gap) while also giving a second threshold set for events that exceed the 95th percentile for at least 2 days, with a 0 day gap. In this way we may screen out smaller events without being to proscriptive about other criteria.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First we calculate the second threshold</span>
thresh_<span class="dv">95</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detect_event.html">detect_event</a></span>(<span class="kw"><a href="../reference/ts2clm.html">ts2clm</a></span>(sst_Med, <span class="dt">pctile =</span> <span class="dv">95</span>,
                                 <span class="dt">climatologyPeriod =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"1982-01-01"</span>, <span class="st">"2011-12-31"</span>)), 
                          <span class="dt">minDuration =</span> <span class="dv">2</span>, <span class="dt">maxGap =</span> <span class="dv">0</span>)<span class="op">$</span>climatology

<span class="co"># Then we use that output when detecting our events</span>
events_<span class="dv">95</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detect_event.html">detect_event</a></span>(<span class="kw"><a href="../reference/ts2clm.html">ts2clm</a></span>(sst_Med, <span class="dt">climatologyPeriod =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"1982-01-01"</span>, <span class="st">"2011-12-31"</span>)), 
                          <span class="dt">threshClim2 =</span> thresh_<span class="dv">95</span><span class="op">$</span>event, <span class="dt">minDuration2 =</span> <span class="dv">2</span>, <span class="dt">maxGap2 =</span> <span class="dv">0</span>)</code></pre></div>
<p>And again let’s look at the results in lolliplot format.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/ggarrange">ggarrange</a></span>(<span class="kw"><a href="../reference/lolli_plot.html">lolli_plot</a></span>(events_<span class="dv">95</span>), <span class="kw"><a href="../reference/lolli_plot.html">lolli_plot</a></span>(events_default), <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Two thresholds"</span>, <span class="st">"One threshold"</span>))</code></pre></div>
<p><img src="complex_clims_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>If we look closely at these results we see that we have actually created more events than we have filtered out. This is because whenever the temperatures dip above the 95th percentile and then back down below it <code><a href="../reference/detect_event.html">detect_event()</a></code> is classifying that as a new event because we have set <code>maxGap = 0</code>. This method allows for a lot of flexibility, but users should also be cautious that they understand what exactly they are asking their machines to do.</p>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>To be quite honest, I didn’t think it was going to work out to just use SST data in place of atmospheric temperature and just create <code>tMin</code> and <code>tMax</code> time series through static subtraction and addition of values. Marine temperatures exhibit much more temporal auto-correlation than atmospheric data, which is why the default minimum length for marine heatwaves is 5 days, and 3 for atmospheric heatwaves. This allows marine events to be detected with the atmospheric definition, but it tends not to work the other way around. That being said, I think that the results of this vignette are clear enough to serve as a guideline for how to implement this methodology with proper atmospheric <code>tMin</code> and <code>tMax</code> data. Indeed, I have run real atmospheric data through this methodology myself and so do know that it works.</p>
<p>We also showed in this vignette a more straight forward approach to using a second threshold through the built-in arguments in <code><a href="../reference/detect_event.html">detect_event()</a></code>. The use of a second threshold in this way, whether it be based on a static threshold or one derived from a percentile, is useful for the consideration of events that may be more specifically relevant to an organism in question.</p>
<p>I hope the techniques shown in this vignette will be useful both technically and theoretically. The authors of <strong><code>heatwaveR</code></strong> are very happy to receive any further input on the development of the package as well as other potential methods for calculating heatwaves and cold-spells.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Perkins2013">
<p>Perkins, Sarah E., and Lisa V. Alexander. 2013. “On the measurement of heat waves.” <em>Journal of Climate</em> 26 (13): 4500–4517. doi:<a href="https://doi.org/10.1175/JCLI-D-12-00383.1">10.1175/JCLI-D-12-00383.1</a>.</p>
</div>
<div id="ref-Wernberg2016">
<p>Wernberg, Thomas, Scott Bennett, Russell C Babcock, Thibaut De Bettignies, Katherine Cure, Martial Depczynski, Francois Dufois, et al. 2016. “Climate driven regime shift of a temperate marine ecosystem.” <em>Science</em> 149 (1996): 2009–12. doi:<a href="https://doi.org/10.1126/science.aad8745">10.1126/science.aad8745</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#the-methodology">The methodology</a></li>
      <li><a href="#visuals">Visuals</a></li>
      <li><a href="#categories">Categories</a></li>
      <li><a href="#double-climatologies">Double climatologies</a></li>
      <li><a href="#summary">Summary</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robert W. Schlegel, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2edc7627dae0471f3d765c3355bebbf3',
    indexName: 'heatwaver',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
